export interface VideoData {
  id: number;
  mainLink: string;
  liteLink: string;
  duration: string;
  lastClicked: string;
  clickCount: number;
  createdAt: string;
  category?: string;
}

// Initial data
export const initialVideoData: VideoData[] = [
  {
    id: 1,
    mainLink: "https://www.tiktok.com/@timerzxc/video/7421407239560301831?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUfPCS/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-20",
    category: "Entertainment"
  },
  {
    id: 2,
    mainLink: "https://www.tiktok.com/@faileskeb7p/video/7389890599555566849?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUywGN/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-20",
    category: "Gaming"
  },
  {
    id: 3,
    mainLink: "https://www.tiktok.com/@faileskeb7p/video/7390359695346748689?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUjMPr/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-20",
    category: "Gaming"
  },
  {
    id: 4,
    mainLink: "https://www.tiktok.com/@bebeushi/video/7380604897227574535?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUAkTU/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-19",
    category: "Entertainment"
  },
  {
    id: 5,
    mainLink: "https://www.tiktok.com/@timerzxc/video/7421722401492274440?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUBxQT/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-19",
    category: "Entertainment"
  },
  {
    id: 6,
    mainLink: "https://www.tiktok.com/@houtiyoudouga/video/7424536517596499207?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUHbos/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-19",
    category: "Music"
  },
  {
    id: 7,
    mainLink: "https://www.tiktok.com/@user4020083207819/video/7437542496978226439?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rU2cGQ/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-18",
    category: "Entertainment"
  },
  {
    id: 8,
    mainLink: "https://www.tiktok.com/@anco013/video/7437380860212514066?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUtJ2s/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-18",
    category: "Entertainment"
  },
  {
    id: 9,
    mainLink: "https://www.tiktok.com/@meigenmikuri/video/7429091445295893767?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUK3U8/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-18",
    category: "Music"
  },
  {
    id: 10,
    mainLink: "https://www.tiktok.com/@tiktoklight_poikatsu/video/7440821943739157768?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUwGGu/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-17",
    category: "Entertainment"
  },
  {
    id: 11,
    mainLink: "https://www.tiktok.com/@mendik.fn/video/7384107089217506592?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUw9vH/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-17",
    category: "Gaming"
  },
  {
    id: 12,
    mainLink: "https://www.tiktok.com/@comingbacktilpchrismas/video/7389172532135333163?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUtpD7/",
    duration: "60 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-17",
    category: "Entertainment"
  },
  {
    id: 13,
    mainLink: "https://www.tiktok.com/@chocolate_cacao/video/7375790723502738696?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUcQRj/",
    duration: "30 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-16",
    category: "Food"
  },
  {
    id: 14,
    mainLink: "https://www.tiktok.com/@douga.ya/video/7369473373262318864?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rydhRX/",
    duration: "30 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-16",
    category: "Music"
  },
  {
    id: 15,
    mainLink: "https://www.tiktok.com/@momiji_2nd/video/7429059819593567509?share_app_id=473824",
    liteLink: "https://lite.tiktok.com/t/ZS6rUK5y6/",
    duration: "30 phút",
    lastClicked: "Chưa click",
    clickCount: 0,
    createdAt: "2024-12-16",
    category: "Music"
  }
];

// Local storage key
const VIDEOS_STORAGE_KEY = 'tiktok_videos_data';

// Get videos from localStorage or return initial data
export function getVideos(): VideoData[] {
  if (typeof window === 'undefined') return initialVideoData;

  try {
    const stored = localStorage.getItem(VIDEOS_STORAGE_KEY);
    if (stored) {
      return JSON.parse(stored);
    }
  } catch (error) {
    console.error('Error reading from localStorage:', error);
  }

  return initialVideoData;
}

// Save videos to localStorage
export function saveVideos(videos: VideoData[]): void {
  if (typeof window === 'undefined') return;

  try {
    localStorage.setItem(VIDEOS_STORAGE_KEY, JSON.stringify(videos));
  } catch (error) {
    console.error('Error saving to localStorage:', error);
  }
}

// Update click tracking for a specific video
export function trackVideoClick(videoId: number, linkType: 'main' | 'lite'): VideoData[] {
  const videos = getVideos();
  const updatedVideos = videos.map(video => {
    if (video.id === videoId) {
      return {
        ...video,
        lastClicked: new Date().toLocaleString('vi-VN'),
        clickCount: video.clickCount + 1
      };
    }
    return video;
  });

  saveVideos(updatedVideos);
  return updatedVideos;
}

// Add new video
export function addVideo(videoData: Omit<VideoData, 'id' | 'clickCount' | 'createdAt' | 'lastClicked'>): VideoData[] {
  const videos = getVideos();
  const newVideo: VideoData = {
    ...videoData,
    id: Math.max(...videos.map(v => v.id), 0) + 1,
    clickCount: 0,
    createdAt: new Date().toISOString().split('T')[0],
    lastClicked: 'Chưa click'
  };

  const updatedVideos = [newVideo, ...videos];
  saveVideos(updatedVideos);
  return updatedVideos;
}

// Remove video
export function removeVideo(videoId: number): VideoData[] {
  const videos = getVideos();
  const updatedVideos = videos.filter(video => video.id !== videoId);
  saveVideos(updatedVideos);
  return updatedVideos;
}

// Get unique categories
export function getCategories(): string[] {
  const videos = getVideos();
  const categories = videos.map(v => v.category || 'Uncategorized');
  return [...new Set(categories)].sort();
}
